@startuml
'https://plantuml.com/deployment-diagram

title "Architecture Overview"

'Definitions'

rectangle "Frontend" {
    component "Development Frontend" << Angular Frontend >> as development_frontend
}

rectangle "Edge Services" {
    component "Reverse Proxy" << NGINX >> as reverse_proxy
    component "Edge Message Broker" << MQTT Broker >> as message_broker_edge
}

rectangle "Event Bus" {
    component "Internal Message Broker" << MQTT Broker >> as message_broker_internal
}

rectangle "Service Layer" {
    component "Pipeline Service" << .NET REST API >> as pipeline_service
    collections  "Operation Worker" <<Python Worker>> as worker
    component "Learning Service" << Python REST API >> as learning_service
    component "File Service" << .NET REST API >> as file_service
}

rectangle "Persistence Layer" {
    component "Dataset Store" << Python REST API >> as dataset_store
    component "MLflow Server" << MLflow >> as mlflow_server
}

rectangle "Database Layer" {
    database "Graph Database" << Neo4j >> as graph_db
    node "S3 BLOB Store" << Localstack >> as blob_store
    'database #line.dashed "Dataset Database" << MongoDB >> as dataset_db
    database "SQL Database" << MySQL >> as mysql_db
}

'Interaction'

development_frontend <--> reverse_proxy
development_frontend --> reverse_proxy

reverse_proxy --> pipeline_service
reverse_proxy --> learning_service
reverse_proxy --> file_service
reverse_proxy <--> message_broker_edge
'TODO: This connection should no longer exist'
reverse_proxy --> dataset_store
reverse_proxy --> mlflow_server

learning_service --> mlflow_server
learning_service --> dataset_store
learning_service --> pipeline_service
learning_service --> blob_store

pipeline_service --> graph_db
pipeline_service <--> message_broker_internal
pipeline_service <--> message_broker_edge

'dataset_store --> dataset_db
'TODO: Default files should be seeded from file service PH-213'
dataset_store --> blob_store

file_service --> blob_store

mlflow_server --> mysql_db
mlflow_server --> blob_store

worker --> dataset_store
worker --> blob_store
worker <--> message_broker_internal

@enduml
